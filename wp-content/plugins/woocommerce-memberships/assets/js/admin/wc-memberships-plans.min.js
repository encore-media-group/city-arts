"use strict";(function(){jQuery(document).ready(function(o){var e,s,l;if(l=null!=(e=window.wc_memberships_admin)?e:{},"wc_membership_plan"===(null!=(s=window.pagenow)?s:""))return o.each(["content-restriction","product-restriction","purchasing-discount"],function(e,s){return l.initializeRuleset(s)}),l.initializeEnhancedSelect(o(".js-ajax-select-products"),{action:"woocommerce_json_search_products_and_variations",security:l.search_products_nonce,screen:"wc_membership_plan"}),o(".js-access-method-selector").on("change",function(e){var s,a,t,n,c,i;return i=o(".js-access-method-selector:checked",".plan-access-method-field").val(),n=o(this).closest(".options_group").find(".js-show-if-access-method-purchase"),a=o(".misc-pub-grant-access"),s=o("span.grant-access-purchase"),t=o("span.grant-access-signup"),c=o("#wp-WC_Memberships_User_Membership_Renewal_Reminder_Email-wrap").parent(".options_group"),"purchase"===i?(n.removeClass("hide"),a.show(),s.show(),t.hide(),c.show()):("signup"===i?(a.show(),t.show(),s.hide()):a.hide(),n.addClass("hide"),c.hide())}).change(),o(".plan-access-length-field").on("change",".js-access-length-type-selector",function(e){var s,a,t,n,c;if(c=o(".js-access-length-type-selector:checked",".plan-access-length-field").val(),n=(a=o(this).closest(".form-field")).find(".js-show-if-access-length-type-specific"),t=a.find(".js-show-if-access-length-type-fixed"),"specific"===c?(n.removeClass("hide"),t.addClass("hide")):"fixed"===c?(n.addClass("hide"),t.removeClass("hide")):(n.addClass("hide"),t.addClass("hide")),(s=a.find(".access_length-amount")).val()||s.val(1),o(this).hasClass("js-access-length-type"))return s.focus()}),o(".js-plan-access-set-date").datepicker({defaultDate:"",dateFormat:"yy-mm-dd",numberOfMonths:1,showButtonPanel:!0,showOn:"button",buttonImage:l.calendar_image,buttonImageOnly:!0}),o("ul.wc-tabs").show(),o("div.panel-wrap").each(function(){return o(this).find("div.panel:not(:first)").hide()}),o("ul.wc-tabs a").click(function(){var e,s,a;switch(a=o(this).attr("href"),s=o(this).closest("div.panel-wrap"),e=o("#wc-memberships-membership-plan-email-content-merge-tags"),o("ul.wc-tabs li",s).removeClass("active"),o(this).parent().addClass("active"),o("div.panel",s).hide(),o(a).show(),"#membership-plan-email-content"===o(this).attr("href")?e.show():e.hide(),o(".js-memberships-restrict-notice").hide(),a){case"#membership-plan-data-restrict-content":o(".js-memberships-restrict-content-notice").show();break;case"#membership-plan-data-restrict-products":o(".js-memberships-restrict-products-notice").show()}return!1}),o("ul.wc-tabs li:visible").eq(0).find("a").click(),o("button.grant-access-modal").on("click",function(e){var s,a;return e.preventDefault(),s=o(this),a={action:"wc_memberships_get_batch_job",security:l.get_memberships_batch_job_nonce,job_name:"grant_retroactive_access",job_id:s.data("plan-id"),process:!0},o.post(l.ajax_url,a,function(e){return e.success?new WC_Memberships_Modal_View_Grant_Access_Membership_Plan({data:{job:null,error:null,plan:{id:s.data("plan-id"),name:s.data("plan-name"),access:s.data("plan-access")}}}):console.log(e)})}),window.WC_Memberships_Modal_View_Grant_Access_Membership_Plan=WC_Memberships_Modal_View.extend({template_id:"wc-memberships-modal-grant-access-membership-plan",initialize:function(e){var s,a,t,n,c,i,r;return r=this,s=e.data.job?e.data.job:null,t=e.data.error?e.data.error:null,c=parseInt(e.data.plan.id,10),i=e.data.plan.name,n=e.data.plan.access,WC_Memberships_Modal_View_Grant_Access_Membership_Plan.__super__.initialize.apply(this,arguments),r.unblock(),s&&s.id?"completed"===s.status||t?window.onbeforeunload=null:(t||(window.onbeforeunload=function(){return l.i18n.confirm_stop_batch_job}),a={action:"wc_memberships_get_batch_job",security:l.get_memberships_batch_job_nonce,job_name:s.name,job_id:s.id,process:!0},o.post(l.ajax_url,a,function(e){return e.data?(r.close(),new WC_Memberships_Modal_View_Grant_Access_Membership_Plan({data:{job:e.success?e.data:null,error:e.success?null:e.data,plan:{id:c,name:i,access:n}}})):console.log(e)})):o("#btn-start").on("click",function(e){return e.preventDefault(),r.block(),a={action:"wc_memberships_grant_retroactive_access",security:l.grant_retroactive_access_nonce,plan_id:c},o.post(l.ajax_url,a,function(e){return e.data?(r.close(),new WC_Memberships_Modal_View_Grant_Access_Membership_Plan({data:{job:e.success?e.data:null,error:e.success?null:e.data,plan:{id:c,name:i,access:n}}})):console.log(e)})})}})})}).call(void 0);